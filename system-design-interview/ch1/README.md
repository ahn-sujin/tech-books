## 캐시

- 값 비싼 **연산 결과** 또는 **자주 참조되는 데이터**를 **메모리** 안에 두고, 뒤이은 요청이 보다 빨리 처리될 수 있도록 하는 **저장소**

### 캐시 계층

- 데이터가 잠시 보관되는 곳으로 데이터 베이스보다 훨씬 빠르다. (성능 개선, 데이터베이스 부하 줄임)
    1. 만일 데이터가 캐시에 있으면 캐시에서 데이터 클라이언트에 반환함 
    2. 없다면 데이터베이스에서 해당 데이터를 읽어 캐시에 저장한 후 클라이언트에 반환함

### 유의할 점

- 캐시를 사용하기 적절한 상황
    
    → 데이터 갱신은 자주 일어나지 않지만 참조는 빈번하게 일어날 때 
    
- 캐시에 두기 적절한 데이터
    
    → 캐시는 데이터를 휘발성 메모리에 두기 때문에 영속적으로 보관할 데이터를 캐시에 두는 것은 바람직하지 않다.
    
- 캐시에 보관된 데이터 만료
    
    → 만료된 데이터는 캐시에서 삭제하는 정책을 마련해 두는 것으 좋다. 정책이 따로 없다면 데이터는 캐시에 계속 남아있게 된다.
    
- 일관성
    
    → 데이터 원본과 캐시 내의 사본이 같아야 한다.
    
- 장애 대체
    
    → 단일 장애 지점 (캐시 서버 한 대만 두는 경우)을 극복하기 위해 여러 지역에 걸쳐 캐시 서버를 분산 시킨다.
    
- 캐시 메모리 크기
    
    → 과할당, 캐시에 보관될 데이터가 갑자기 늘어났을 때 방지
    
- 데이터 방출 정책
    
    → 캐시가 꽉 차버리면 추가로 캐시를 데이터에 넣어야 할 경우 기존 데이터를 내보내야 한다. (LRU, LFU, FIFO)
    

### 결론

**데이터베이스 부하**를 줄일 수 있다.

<br />

## 콘텐츠 전송 네트워크 (CDN)

- CDN은 정적 콘텐츠(이미지, 비디오, CSS, JS)를 전송하는데 쓰이는 지리적으로 분산된 서버의 네트워크
- 클라이언트에서 정적 콘텐츠 요청이 들어왔을 때, 가장 가까운 CDN 서버가 정적 콘텐츠를 전달한다.
    1. CDN 서버의 캐시에 해당 이미지가 없는 경우 서버는 원본 서버에서 요청해 파일을 가져온다.
        1. 있는 경우 바로 CDN 서버에서 전송한다.
    2. 원본 서버가 파일을 CDN서버에 반환한다. 
    3. CDN 서버는 파일을 캐시하고 클라이언트에 반환한다.

### 고려해야 할 사항

- 비용
    - 데이터 전송 양에 따라 요금을 내기 때문에, 자주 사용되지 않는 콘텐츠는 빼두는 것이 좋다.
- 적절한 만료 시한 설정
    - 너무 길면 콘텐츠의 신선도가 떨어지고, 너무 짧으면 원본 서버에 빈번히 접속하게 되어 좋지 않다.
- CDN 장애 대처 방안
    - CDN 자체가 죽었을 때 어떻게 대체할지 방안이 있어야 한다. (예를 들면 문제가 발생하면 원본 서버에서 가져오도록한다던지…)
- 콘텐츠 무효화
    - 만료되지 않은 콘텐츠더라도 CDN에서 제거할 수 있다.

### 결론

정적 콘텐츠는 더 이상 웹 서버(AWS S3)를 통해 서비스하지 않으며 CDN을 통해 제공하여 **더 나은 성능을 보장**한다.
